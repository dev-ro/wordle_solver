name: Update Dictionaries

on:
  push:
    branches: [ main ]
    paths: [ 'assets/words/**' ]
  workflow_dispatch:

jobs:
  update-dictionaries:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Validate dictionary files
      run: |
        echo "Validating dictionary files..."
        for file in assets/words/*.json; do
          if [ -f "$file" ]; then
            echo "Validating $file"
            python3 -m json.tool "$file" > /dev/null
            echo "‚úÖ $file is valid JSON"
          fi
        done
        
    - name: Setup Google Cloud CLI
      uses: google-github-actions/setup-gcloud@v2
      with:
        project_id: wordle-solver-kyle
        
    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v2
      with:
        credentials_json: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_WORDLE_SOLVER_KYLE }}
        
    - name: Upload dictionaries to Cloud Storage
      run: |
        echo "Uploading dictionary files to Cloud Storage..."
        
        # Create dictionaries directory if it doesn't exist
        gsutil -m ls gs://wordle-solver-kyle.appspot.com/dictionaries/ || gsutil -m mkdir gs://wordle-solver-kyle.appspot.com/dictionaries/
        
        # Upload dictionary files
        gsutil -m cp assets/words/*.json gs://wordle-solver-kyle.appspot.com/dictionaries/
        
        # List uploaded files for verification
        echo "Files in Cloud Storage:"
        gsutil ls gs://wordle-solver-kyle.appspot.com/dictionaries/
        
    - name: Deploy Storage rules
      run: |
        # Install Firebase CLI
        npm install -g firebase-tools
        
        # Deploy storage rules
        firebase deploy --only storage:rules --project wordle-solver-kyle --non-interactive
      env:
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_WORDLE_SOLVER_KYLE }}
        
    - name: Notify completion
      run: |
        echo "‚úÖ Dictionary files updated successfully in Cloud Storage"
        echo "üìÅ Files uploaded:"
        gsutil ls gs://wordle-solver-kyle.appspot.com/dictionaries/
